<!DOCTYPE html>
<html lang="ru">
<head>
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="CalcApp">
<meta name="mobile-web-app-capable" content="yes">

<link rel="apple-touch-icon" href="https://via.placeholder.com/192"> 
 <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CalcApp Web</title>
    <style>
        :root {
            --primary: #1a7f37;
            --bg: #f4f4f9;
            --card: #ffffff;
        }
        body { font-family: -apple-system, Segoe UI, Roboto, sans-serif; background: var(--bg); margin: 0; padding: 15px; color: #333; }
        .container { max-width: 500px; margin: 0 auto; background: var(--card); padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #222; margin-top: 0; }
        
        .field-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.9em; margin-bottom: 5px; color: #666; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 16px; }
        
        .base-row { display: flex; gap: 10px; }
        .base-row select { flex: 2; }
        .base-row input { flex: 1; background: #eee; }

        .result-box { text-align: center; background: #eef9f1; padding: 15px; border-radius: 10px; margin: 20px 0; border: 1px solid #cce7d5; }
        .result-val { font-size: 28px; font-weight: bold; color: var(--primary); }
        .formula-text { font-size: 11px; color: #888; margin-top: 5px; word-break: break-all; }

        button { width: 100%; padding: 14px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-bottom: 10px; transition: 0.2s; font-size: 14px; }
        .btn-save { background: var(--primary); color: white; }
        .btn-history { background: #666; color: white; }
        .btn-editor { background: #007bff; color: white; }
        button:active { opacity: 0.8; transform: scale(0.98); }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; overflow-y: auto; }
        .modal-content { background: white; margin: 20px auto; padding: 20px; width: 90%; max-width: 450px; border-radius: 12px; }
        .history-item { font-family: monospace; font-size: 12px; border-bottom: 1px solid #eee; padding: 8px 0; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>

<div class="container">
    <h2>CalcApp Pro</h2>

    <div class="field-group">
        <label>–ó–Ω–∞—á–µ–Ω–∏–µ A (1-100):</label>
        <input type="number" id="valA" value="46" oninput="calculate()">
    </div>

    <div class="field-group">
        <label>–ó–Ω–∞—á–µ–Ω–∏–µ B:</label>
        <input type="number" id="valB" value="2.4" step="0.1" oninput="calculate()">
    </div>

    <div class="field-group">
        <label>–ó–Ω–∞—á–µ–Ω–∏–µ D:</label>
        <input type="number" id="valD" value="145" oninput="calculate()">
    </div>

    <div class="field-group">
        <label>–ë–∞–∑–∞ (C):</label>
        <div class="base-row">
            <select id="baseSelect" onchange="onBaseChange()"></select>
            <input type="text" id="valC" readonly>
        </div>
    </div>

    <div class="field-group">
        <label>–§–æ—Ä–º—É–ª–∞:</label>
        <input type="text" id="formula" value="(({A} * {B} + {C}) / {D}) * 100 - 100" oninput="calculate()">
    </div>

    <div class="result-box">
        <div class="result-val" id="resDisplay">0.00 %</div>
        <div class="formula-text" id="detailsDisplay">–í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ...</div>
    </div>

    <button class="btn-save" onclick="saveToHistory()">‚úÖ –°–û–•–†–ê–ù–ò–¢–¨ –í –ò–°–¢–û–†–ò–Æ</button>
    <button class="btn-editor" onclick="openEditor()">‚öô –†–ï–î–ê–ö–¢–û–† –ë–ê–ó–´</button>
    <button class="btn-history" onclick="openHistory()">üìú –ü–û–ö–ê–ó–ê–¢–¨ –ò–°–¢–û–†–ò–Æ</button>
</div>

<div id="modalHistory" class="modal">
    <div class="modal-content">
        <h3>–ò—Å—Ç–æ—Ä–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤</h3>
        <div id="historyList"></div>
        <button onclick="clearHistory()" style="background:#dc3545; color:white; margin-top:15px;">–û—á–∏—Å—Ç–∏—Ç—å</button>
        <button onclick="closeModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<div id="modalEditor" class="modal">
    <div class="modal-content">
        <h3>–†–µ–¥–∞–∫—Ç–æ—Ä –±–∞–∑—ã C</h3>
        <table id="baseTable">
            <thead><tr><th>–ò–º—è</th><th>C</th><th></th></tr></thead>
            <tbody id="baseTableBody"></tbody>
        </table>
        <button onclick="addNewBase()" style="background:#28a745; color:white;">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        <button onclick="closeModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
// –ó–Ω–∞—á–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ—Ç–µ –≤ –∫–æ–¥–µ
const DEFAULT_BASES = {
    "6 –õ–ï–†–£–ê": 8.64,
    "8 –õ–ï–†–£–ê": 10.56,
    "10 –õ–ï–†–£–ê": 12.48,
    "12 –õ–ï–†–£–ê": 9.36,
    "8 HARD": 5.76,
    "10 HARD": 6.72,
    "8 –ì–û–°–¢": 9.96,
    "10 –ì–û–°–¢": 8.16,
    "6 ST": 7.68,
    "8 ST": 9.6,
    "10 ST": 11.52,
    "12 ST": 12.96,
    "4 PRO": 3.84,
    "6 PRO": 8.64,
    "8 PRO": 10.56,
    "10 PRO": 12.48,
    "12 PRO": 12.96,
    "14 PRO": 10.56,
    "16 PRO": 10.8
};

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –≤ –ø–∞–º—è—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
let savedBases = localStorage.getItem('bases');
let BASES;

if (savedBases) {
    BASES = JSON.parse(savedBases);
    
    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–∑ DEFAULT_BASES, –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç –≤ –ø–∞–º—è—Ç–∏
    Object.keys(DEFAULT_BASES).forEach(key => {
        if (!(key in BASES)) {
            BASES[key] = DEFAULT_BASES[key];
        }
    });
} else {
    // –ï—Å–ª–∏ –ø–∞–º—è—Ç–∏ –Ω–µ—Ç ‚Äî –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç
    BASES = { ...DEFAULT_BASES };
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
        renderBaseSelect();
        calculate();
    }

    function renderBaseSelect() {
        const sel = document.getElementById('baseSelect');
        const current = sel.value;
        sel.innerHTML = '';
        Object.keys(BASES).forEach(name => {
            const opt = document.createElement('option');
            opt.value = name;
            opt.textContent = name;
            sel.appendChild(opt);
        });
        if (current && BASES[current]) sel.value = current;
        onBaseChange();
    }

    function onBaseChange() {
        const name = document.getElementById('baseSelect').value;
        document.getElementById('valC').value = BASES[name] || 0;
        calculate();
    }

    function calculate() {
        try {
            const a = document.getElementById('valA').value || "0";
            const b = document.getElementById('valB').value || "0";
            const c = document.getElementById('valC').value || "0";
            const d = document.getElementById('valD').value || "1";
            let f = document.getElementById('formula').value;

            f = f.replace(/{A}/g, a).replace(/{B}/g, b).replace(/{C}/g, c).replace(/{D}/g, d);
            
            // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –º–∞—Ç–µ–º–∞—Ç–∏–∫–∞)
            const cleanF = f.replace(/[^-()\d/*+.]/g, '');
            const res = eval(cleanF);
            
            document.getElementById('resDisplay').textContent = res.toFixed(2) + " %";
            document.getElementById('detailsDisplay').textContent = "–§–æ—Ä–º—É–ª–∞: " + f;
            return { f, res: res.toFixed(2) };
        } catch (e) {
            document.getElementById('resDisplay').textContent = "---";
        }
    }

    // –ò–°–¢–û–†–ò–Ø
    function saveToHistory() {
        const data = calculate();
        if (!data) return;
        const history = JSON.parse(localStorage.getItem('calc_history')) || [];
        const time = new Date().toLocaleString('ru-RU', {hour:'2-digit', minute:'2-digit', day:'2-digit', month:'2-digit'});
        history.unshift(`[${time}] ${data.f} = ${data.res}%`);
        localStorage.setItem('calc_history', JSON.stringify(history.slice(0, 50)));
        alert("–ó–∞–ø–∏—Å–∞–Ω–æ!");
    }

    function openHistory() {
        const history = JSON.parse(localStorage.getItem('calc_history')) || [];
        document.getElementById('historyList').innerHTML = history.map(i => `<div class="history-item">${i}</div>`).join('') || "–ü—É—Å—Ç–æ";
        document.getElementById('modalHistory').style.display = 'block';
    }

    function clearHistory() {
        if(confirm("–û—á–∏—Å—Ç–∏—Ç—å?")) {
            localStorage.removeItem('calc_history');
            openHistory();
        }
    }

    // –†–ï–î–ê–ö–¢–û–†
    function openEditor() {
        const body = document.getElementById('baseTableBody');
        body.innerHTML = '';
        Object.entries(BASES).forEach(([name, val]) => {
            body.innerHTML += `<tr>
                <td>${name}</td>
                <td>${val}</td>
                <td><button onclick="deleteBase('${name}')" style="padding:4px; margin:0; background:#f44">X</button></td>
            </tr>`;
        });
        document.getElementById('modalEditor').style.display = 'block';
    }

    function addNewBase() {
        const name = prompt("–ù–∞–∑–≤–∞–Ω–∏–µ:");
        const val = parseFloat(prompt("–ó–Ω–∞—á–µ–Ω–∏–µ C:"));
        if (name && !isNaN(val)) {
            BASES[name] = val;
            saveBases();
        }
    }

    function deleteBase(name) {
        if(confirm(`–£–¥–∞–ª–∏—Ç—å ${name}?`)) {
            delete BASES[name];
            saveBases();
        }
    }

    function saveBases() {
        localStorage.setItem('bases', JSON.stringify(BASES));
        renderBaseSelect();
        openEditor();
    }

    function closeModals() {
        document.querySelectorAll('.modal').forEach(m => m.style.display = 'none');
    }

    window.onclick = function(event) {
        if (event.target.className === 'modal') closeModals();
    }

    init();
</script>

</body>
</html>
